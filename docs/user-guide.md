
# Пользовательская инструкция по работе с ботом

Инструкция описывает работу с ботом с точки зрения обычного пользователя Telegram. Предполагается, что бот уже развёрнут и у вас есть его имя/ссылка.

## 1. Подготовка экспорта чата в Telegram

1. Откройте нужный чат в Telegram (группа).

2. Выполните экспорт истории чата (рекомендуется **Telegram Desktop**).

3. В параметрах экспорта:

* выберите нужный чат;
* выберите формат **JSON**;
* сохраните экспорт на устройство.

> **Важно:** в текущей версии бот поддерживает **только JSON** (`*.json`).

---

## 2. Поиск и запуск бота

1. В Telegram найдите бота по имени и откройте диалог.

2. Нажмите **Start** или отправьте команду:

* `/start`

3. Бот отправит приветственное сообщение и покажет меню с кнопками:

* **Как экспортировать чат**
* **FAQ**

Эти кнопки можно нажимать в любой момент — бот пришлёт подсказки.

---

## 3. Загрузка файлов экспорта

1. В диалоге с ботом нажмите **скрепку** (прикрепить файл).

2. Выберите отправку **как Файл/Документ** (не как фото/видео).

3. Выберите JSON-файл(ы) экспорта и отправьте боту.

4. После каждого файла бот подтверждает приём и показывает, сколько файлов уже загружено, например:

* `Файл принят. Сейчас загружено: 2 файл(ов).`

5. После загрузки хотя бы одного валидного файла в меню появится кнопка:

* **Начать обработку**

**Ограничения:**

* можно загрузить **от 1 до 10** файлов за одну обработку;
* поддерживаются только файлы `*.json`.

Если вы отправите файл не в JSON-формате — бот ответит:

* `Неподдерживаемый формат файла. Поддерживается только JSON.`

Если файлов уже 10 — бот сообщит:

* `Можно загрузить не более 10 файлов за одну обработку. Начните новую сессию.`
  и предложит кнопку **«Обработать другой чат»**.

---

## 4. Запуск обработки

1. Когда вы загрузили нужное количество файлов, нажмите:

* **Начать обработку**

2. Бот начнёт обработку и пришлёт сообщение вида:

* `Начинаю обработку N файл(ов). Пожалуйста, подождите.`

3. Далее бот обрабатывает файлы **по очереди** и отправляет **отдельный результат по каждому файлу**, например:

* `Файл 2/3 обработан.`

> Во время обработки новые файлы **не добавляются** в текущую обработку.
> Если отправить файл во время обработки, бот ответит:
> `Обработка уже выполняется. Этот файл не войдет в текущий отчет.`

---

## 5. Получение результата

Для каждого обработанного файла бот отправляет:

* имя файла,
* количество участников,
* количество упоминаний,
* результат в виде текста или Excel.

### 5.1 Текстовый результат (если участников ≤ 50)

Если количество участников в файле **≤ 50**, бот пришлёт сообщение со структурой:

* **Файл:** `chat1.json`
* **Количество участников:** N
* **Количество упоминаний:** M

**Участники:**

* Имя Фамилия
* …

**Упоминания:**

* @username
* …

### 5.2 Excel-результат (если участников ≥ 51)

Если количество участников в файле **≥ 51**, бот сформирует и отправит Excel-файл.

Excel содержит 3 вкладки:

* **Участники**
* **Упоминания**
* **Каналы**

---

## 6. Что делать после завершения

После того как бот отправит результат(ы), появится кнопка:

* **Обработать другой чат**

Она запускает новый сценарий: можно загрузить другие файлы и снова начать обработку.

---

## 7. Команды

* `/start` — начать работу и открыть меню.
* `/stop` — остановить текущую сессию и очистить загруженные файлы.
  Бот ответит:
  `Ок, остановил текущую сессию. Чтобы начать заново — нажмите /start.`

Если сессия истекла по времени (TTL), бот сообщит:

* `Сессия истекла. Пожалуйста, начните заново.`
  и покажет кнопку:
* **Начать заново**

> **Как работает таймаут (TTL) сессии**
> Сессия бота имеет ограниченное время жизни (TTL) — если пользователь долго не взаимодействует с ботом, сессия считается истёкшей.
> Таймаут применяется **“лениво”**: бот проверяет TTL **при следующем действии пользователя** (сообщение, файл или нажатие кнопки).
> Если сессия истекла — бот сообщает об этом, очищает загруженные файлы и предлагает начать заново.

---

## 8. Типичные ограничения и рекомендации

* Используйте **свежий экспорт**, чтобы список был максимально актуальным.
* Не редактируйте JSON вручную и не меняйте структуру файла.
* Отправляйте файл именно как **документ**, чтобы Telegram не изменил содержимое.
* Если файлов слишком много — отправьте экспорт частями (до 10 файлов за раз).
* Не отправляйте посторонние файлы (архивы, картинки, документы), если это не JSON-экспорт Telegram.

---

## 9. Частые ошибки и решения (FAQ)

### 9.1 «Неподдерживаемый формат файла. Поддерживается только JSON.»

**Причина:** отправлен не `*.json` (например, HTML/ZIP/скриншот/фото/другой документ).
**Что делать:**

* экспортируйте чат заново в Telegram Desktop в формате **JSON**;
* отправляйте файл именно как **Документ/Файл**, а не как фото/видео.

---

### 9.2 «Сначала загрузите хотя бы один файл экспорта.»

**Причина:** нажали **«Начать обработку»**, но в сессии ещё нет загруженных файлов.
**Что делать:**

* сначала прикрепите 1+ JSON-файл(ов), дождитесь сообщения **«Файл принят…»**;
* затем нажмите **«Начать обработку»**.

---

### 9.3 «Можно загрузить не более 10 файлов за одну обработку. Начните новую сессию.»

**Причина:** достигнут лимит — в одну обработку можно загрузить **максимум 10 файлов**.
**Что делать:**

* нажмите кнопку **«Обработать другой чат»** и загрузите оставшиеся файлы заново (новая сессия);
* либо отправьте `/stop`, затем `/start`, и повторите загрузку.

---

### 9.4 «Обработка уже выполняется. Этот файл не войдет в текущий отчет.»

**Причина:** вы отправили файл, когда бот уже находится в процессе обработки.
**Что делать:**

* дождитесь окончания текущей обработки (бот пришлёт результаты по файлам);
* затем нажмите **«Обработать другой чат»** и отправьте файл(ы) снова.

---

### 9.5 «Сессия истекла. Пожалуйста, начните заново.»

**Причина:** прошло слишком много времени с последнего действия (TTL).
**Важно:** таймаут применяется **при следующем действии** — то есть сообщение об истечении появится, когда вы снова отправите сообщение/файл или нажмёте кнопку.
**Что делать:**

* нажмите кнопку **«Начать заново»** или отправьте `/start`;
* затем заново загрузите JSON-файл(ы) и нажмите **«Начать обработку»**.

---

### 9.6 «Произошла ошибка при обработке файлов. Проверьте формат экспорта и попробуйте снова.»

**Причина:** файл повреждён, экспорт неполный/не тот формат, либо Telegram изменил файл при отправке.
**Что делать:**

* убедитесь, что файл **JSON** и отправлен как **Документ/Файл**;
* повторите экспорт в Telegram Desktop;
* попробуйте отправить сначала **один** файл и проверить, что он обрабатывается.

---

### 9.7 «Неизвестная команда.»

**Причина:** отправлено сообщение/команда, которую бот не поддерживает.
**Что делать:**

* используйте команды:

  * `/start` — начать работу
  * `/stop` — остановить текущую сессию
* или используйте кнопки меню: **«Как экспортировать чат»**, **«FAQ»**, **«Начать обработку»**.

---

### 9.8 «Ок, остановил текущую сессию… Чтобы начать заново — нажмите /start.»

**Это не ошибка.** Это подтверждение, что команда `/stop` сработала.
**Что делать дальше:**

* отправьте `/start`, чтобы начать новую сессию и загрузить файлы заново.

---

### 9.9 Бот отвечает, но список “не полный”

**Причина:** бот формирует список по данным экспорта: он видит тех, кто **писал сообщения**, и тех, кого **упоминали**. Пользователь, который есть в группе, но **не писал** и **не упоминался**, может не появиться.
**Что делать:**

* сделайте экспорт “полнее” (за больший период);
* проверьте, что в истории чата действительно есть сообщения/упоминания нужных участников.

---
